<!DOCTYPE html>
<html><head>
<title>Chapter 3 - FAQ</title>
<meta charset='utf-8'>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/css/bootstrap-combined.min.css" rel="stylesheet">
<link href="style.css" rel="stylesheet">
</head>
<body>
<div class="container">
    <div class="row">
        <div class="offset2 span8">
<p>Chapter 3</p>

<h1>FAQ</h1>

<p><a href="index.html">Index</a></p>

<h2>What is the meaning of G0 and G1?</h2>

<p>G0 defines exactly what tokens are acceptable in the input stream. So, these are the rules defining the
syntax of the tokens, but not the syntax of how these tokens can be combined.</p>

<p>G1 defines the structure of the language. These rules define legal statements within the given language.
Legal statements are thus legal combinations of tokens.</p>

<p>Also, G1 rules have a semantics, whereas G0 rules do not.</p>

<p>G0 and G1 discussed in <a href="https://metacpan.org/release/Marpa-R2-Scanless-DSL">Marpa::R2::Scanless::DSL</a>, and, very
briefly, in <a href="https://metacpan.org/release/Marpa-R2-Semantics">Marpa::R2::Semantics</a>. In both cases, search for 'G0'.</p>

<h2>How do I parse numbers?</h2>

<p>Chapter 2 discusses this issue at length. And if you fork the project on github, you'll find the directory
examples/ contains about a dozen sample programs.</p>

<p>Alternately, download <a href="https://metacpan.org/release/MarpaX-Languages-SVG-Parser">MarpaX::Languages::SVG::Parser</a>,
which contains similar logic (in data/*.bnf). Further, the distro includes sample code (float.pl and number.pl)
in the scripts/ directory. The last-named script includes grammars for binary, octal and hex numbers.</p>

<h2>How do I represent choice in the grammar?</h2>

<p>Briefly, use '|'. Sample code from the above named module (data/d.bnf):</p>

<pre class="prettyprint linenums"><code>coordinate  ::= float      action =&gt; float
                | integer  action =&gt; integer
</code></pre>

<p>Also note that '||' is available to control the relative priorities of the alternatives. This issue is expanded
in a later item in this FAQ.</p>

<p>See also the next item.</p>

<h2>Is there any other way of representing choice?</h2>

<p>Sure. Consider these G0 rules (also from data/d.bnf):</p>

<pre class="prettyprint linenums"><code>sign_maybe  ~ [+-]
sign_maybe  ~

digit       ~ [0-9]
digit_any   ~ digit*
digit_many  ~ digit+

E           ~ [Ee] sign_maybe digit_many
E_maybe     ~ E
E_maybe     ~

:lexeme     ~ float
float       ~ sign_maybe digit_many E
              | sign_maybe digit_any '.' digit_many E_maybe
              | sign_maybe digit_many '.' E_maybe
              | sign_maybe non_zero digit_any
</code></pre>

<p>This is saying:</p>

<ul>
<li><p>The sign is optional after E or e (sign_maybe)</p></li>
<li><p>The E is optional (E_maybe)</p></li>
<li><p>The sign is optional before a digit (the first alternative for 'float')</p></li>
<li><p>And so on</p></li>
</ul>

<h2>What does it mean to hide (mask) tokens?</h2>

<p>It's possible to design a grammar such that we can say certain tokens are hidden. This is discussed in the docs
for <a href="https://metacpan.org/release/Marpa-R2-Scanless-DSL">Marpa::R2::Scanless::DSL</a>.</p>

<p>Here is an example (from <a href="https://metacpan.org/release/Graph-Easy-Marpa-Parser">Graph::Easy::Marpa::Parser</a>):</p>

<pre class="prettyprint linenums"><code>node_definition  ::= node_statement
                 | node_statement graph_definition

node_statement   ::= node_name
                 | node_name attribute_definition
                 | node_statement (',') node_statement

node_name        ::= start_node end_node

:lexeme          ~ start_node  pause =&gt; before  event =&gt; start_node
start_node       ~ '['

:lexeme          ~ end_node
end_node         ~ ']'
</code></pre>

<p>The comma is hidden. But what does this mean, exactly?</p>

<p>It means the comma may appear in the input stream (in this context), but I am not interested in it. So, Marpa will not
return this token to me when an action is called. It has become invisible to the semantics.</p>

<p>Semantics are documented in <a href="https://metacpan.org/release/Marpa-R2-Semantics">Marpa::R2::Semantics</a>.</p>

<p>Close study of the above grammar will show that another path is possible thru the grammar, in the case of
2 nodes side-by-side (i.e. without a comma between them). Thus the grammar accepts both these input streams
as valid:</p>

<pre class="prettyprint linenums"><code>Stream 1: [node.a], [node.b]
Stream 2: [node.a]  [node.b]
</code></pre>

<p>Hence, from the end-user's viewpoint, the comma is defined - at least in this particular grammar - to be optional.</p>

<h2>What's the difference between '|' and '||' in grammar definitions?</h2>

<p>'|' expresses a simple alternative, while '||' separates alternatives at different levels of precedence. For example:</p>

<pre class="prettyprint linenums"><code>E ::=    E '*' E
      |  E '/' E
      || E '+' E
      |  E '-' E
</code></pre>

<p>This describes syntax for a simple 4-operation calculator, where multiplication and division take precedence over
addition and subtraction.</p>

<p>This construct forces alternatives before the '||' to have higher precedence than the alternatives after that token.</p>

<p>Each of the alternatives separated by '|' are at the same precedence.</p>

<p>In Mark Dominus's 'Higher-Order Perl' book, he describes how he handles precedence in his recursive descent parsers
for a similar calculator, beginning on p. 394. This is a good description of how the same situation would be handled
with pre-Marpa techniques.</p>

<p>If precedence is not an issue for you, just use single bar alternation ('|').</p>

<p>Note also that Marpa supports a 'priority' adverb, discussed in the
<a href="https://metacpan.org/release/Marpa-R2-Scanless-DSL">Marpa::R2::Scanless::DSL</a> docs mentioned above.</p>

<h2>How to I implement recursion in a grammar?</h2>

<p>See the next item.</p>

<h2>Why does using '+' or '*' in a rule only work sometimes?</h2>

<p>I assume you're referring to cases like this:</p>

<p>Case 1 (fails):</p>

<pre class="prettyprint linenums"><code>node_definition  ::= node_statement+
                 | node_statement graph_definition
</code></pre>

<p>Case 2 (succeeds):</p>

<pre class="prettyprint linenums"><code>coordinate_list  ::= coordinate+
</code></pre>

<p>Case 3 (succeeds):</p>

<pre class="prettyprint linenums"><code>whitespace       ~ [\s]+
</code></pre>

<p>Briefly, quantified rules (here, using the '+'), are only allowed when the right-hand side contains a single
alternative. Thus case 1 fails due to the combination of '+' and '|'.</p>

<p>This is documented in <a href="https://metacpan.org/release/Marpa-R2-Scanless-DSL">Marpa::R2::Scanless::DSL</a>, under
'Quantified rules'.</p>

<p>So we must re-write rule 1:</p>

<pre class="prettyprint linenums"><code>graph_definition  ::= node_definition
                  | edge_definition
                  | subgraph_definition

node_definition  ::= node_statement
                 | node_statement graph_definition

node_statement   ::= node_name
                 | node_name attribute_definition
                 | node_statement (',') node_statement
</code></pre>

<p>Now the rule 'node_definition ::= node_statement' allows a node definition to consist of a single node statement.</p>

<p>And the alternative - via the '|' - 'node_definition ::= node_statement graph_definition' allows a node
definition to consist of a node statement followed by a graph definition, which just happens to include the line
'graph_definition ::= node_definition'!</p>

<p>So we've managed to write the grammar using indirect recursion, thus allowing an indefinite list of node
definitions to follow one another. And the last rule allows the input stream to separate them with commas as
well as the usual spaces.</p>

<h2>How do I find out where I am within the input stream?</h2>

<p>In the docs for Marpa::R2::Scanless::R, see the line_column() method.</p>

<h2>How do I find out which rule applies at some point in the input stream?</h2>

<p>In the docs for Marpa::R2::Semantics, the section titled 'Action context' shows how to access internal variables in
Marpa which do what you want.</p>

<h2>Wat is the meaning of the line number in a Marpa error message?</h2>

<p>It is the line number within the BNF of the rule being processed.</p>

<p>Note: If your grammar uses \r, that will affect the line count.</p>

<p>More specifically, in the docs for Marpa::R2::Scanless::R, under the line_column() method, a range of special characters
are listed.</p>

<h2>How do I associate an action class with my grammar?</h2>

<p>The synopsis in Marpa::R2::Semantics shows one way. See 'bless_package'.</p>

<p>Another way is to note that the Scanless interface recognizer accepts a 'semantics_package' argument.</p>

<p>Here's how I declare a recognizer:</p>

<pre class="prettyprint linenums"><code>$self -&gt; recce
(
    Marpa::R2::Scanless::R -&gt; new
    ({
        grammar           =&gt; $self -&gt; grammar,
        semantics_package =&gt; 'MarpaX::Languages::SVG::Parser::Actions',
    })
);
</code></pre>

<p>So actions referenced in the grammar, as in:</p>

<pre class="prettyprint linenums"><code>coordinate  ::= float      action =&gt; float
                | integer  action =&gt; integer
</code></pre>

<p>are declared in the named package, and that's where Marpa looks for them.</p>

<p>This is discussed both in <a href="https://metacpan.org/release/Marpa-R2-Scanless-R">Marpa::R2::Scanless::R</a>, and in
<a href="https://metacpan.org/release/Marpa-R2-Semantics">Marpa::R2::Semantics</a>.</p>

<p>From an OO point of view, there is still a problem. After reading the 'The per-parse argument' and
'The per-parse constructor' sections of the semantics document, you might think:</p>

<pre class="prettyprint linenums"><code>Marpa calls the constructor of the semantics package.
That means Marpa has an instance of that package.
</code></pre>

<p>This immediately raises some questions:</p>

<ul>
<li>How do I access that instance?</li>
</ul>

<p>I don't know.</p>

<ul>
<li>If I use Moo to write this package, what happens?</li>
</ul>

<p>The problem here is that with <a href="https://metacpan.org/release/Moo">Moo</a>, the new() constructor is generated automatically.
My tests show such a package is not initialized (by calling new() ) by Marpa. That is, Marpa cannot find new(), and
so it passes an unblessed hash into each action sub, as the per-parse (1st) parameter.</p>

<ul>
<li>In the latter case, which instance is Marpa calling?</li>
</ul>

<p>I don't know.</p>

<ul>
<li>If my action subs accumulate instance-level data, how can I retrieve such data?</li>
</ul>

<p>I don't know, but it 'just works'. I use this code:</p>

<pre class="prettyprint linenums"><code>$self -&gt; actions
(
    MarpaX::Languages::SVG::Parser::Actions -&gt; new(logger =&gt; $self -&gt; logger)
);
</code></pre>

<p>along with the initialization of $self -> recce(...) above.</p>

<p>Later, when I use $self -> action to access data with my instance, I get the data generated in the calls by Marpa
to my action subs.</p>

<h2>How do I implement disambiguation logic?</h2>

<p>In the docs for Marpa::R2::Semantics, the section titled 'Bailing out of parse evaluation' discusses how to short-circuit
semantic analysis.</p>

<p><a href="index.html">Index</a></p>
        </div>
    </div>
    <div class="row footer">
        <div class="offset2 span8">
            <p>
                <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img alt="Creative Commons License" style="float:left; margin-right:12px; border-width:0" src="http://i.creativecommons.org/l/by-sa/3.0/88x31.png" /></a><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">Marpa Guide</span> by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Peter Stuifzand and Contributors</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/">Creative Commons Attribution-ShareAlike 3.0 Unported License</a> and the <a rel="license" href="http://www.gnu.org/copyleft/fdl.html">GNU Free Documentation License 1.3</a></p>
        </div>
    </div>
</div>
<script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.2.2/js/bootstrap.min.js"></script>
</body></html>
